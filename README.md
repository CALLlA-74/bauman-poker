# Курсовая работа по протоколам вычислительных сетей

В ходе выполнения данной работы были разработаны протокол онлайн-игры "ПОКЕР" и программный прототип системы, демонстирующей работу протокола. Описание протокола приведено в  [файле "РПЗ_курсовой.pdf" в разделе 2. "Конструкторская часть" (с. 19).](https://github.com/CALLlA-74/bauman-poker/blob/main/docs/%D0%A0%D0%9F%D0%97_%D0%BA%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B9.pdf) 
## Структура системы
Система подразделяется на *frontend* и *backend*. *Frontend* представлен десктопным приложением, предоставляющим интерфейс для регистрации/авторизации, подбора игровой комнаты и взаимодействия в процессе игры с другими игроками. *Backend* имеет микросервисную архитектуру и состоит из следующих микросервисов:
1. *Game-server*. Отвечает за прием и обработку запросов от *Frontend*, подбор комнаты игроку, получение сообщений о действиях игрока в процессе игры и обновлении состояний комнаты (в том числе комбинации карт на столе, перетасовывание и распределение карт между игроками в комнате) и уведомлении игроков внутри комнат о действиях других игроков и изменении состояний комнат. Полное описание запросов и сообщений, принимаемых *Game-server* описано в [API](https://github.com/CALLlA-74/bauman-poker/tree/main/docs/api).
2. *Identity Provider*. Отвечает за регистрацию/авторизацию пользователей. Для хранения данных пользовательских аккаунтов используется СУБД Postgre SQL. В качестве ответа при успешной **регистрации/авторизации** пользователь получает пару токенов: *ACCESS* и *REFRESH*, защищенных цифровой подписью с помощью алгоритма RS256. *Access*-токен отправляется в заголовках всех остальных запросов к системе для подтверждения своих прав доступа на запрашиваемое действие. Валидация токена осуществляется путем проверки его подписи: каждый из сервисов запрашивает у *Identity Provider* список публичных JWK и по kid токена находит ключ для проверки подписи.
  После экспирации *Access*-токена новая пара токенов может быть получена с помощью токена *Refresh* (если период его экспирации еще не прошел; иначе требуется повторная авторизация пользователя по логину и паролю). Периоды экспирации токенов настраиваются в конфигурации сервиса *Identity Provider*.
## Руководство по развертыванию

### Локальное развертывание
Для локального развертывания на устройстве необходимо иметь установленный [docker compose](https://docs.docker.com/compose/install/standalone/). 
* Далее запустить сборку образов: `docker compose build`
* Затем поднять контейнеры: `docker compose up -d`

### Развертывание на ВМ в VK-Cloud
В ходе выполнения работы разработанный прототип развертывался на виртуальной машине, арендованной в PaaS VK Cloud.
Перед тем, как приступить к загрузке и развертыванию сервиса необходимо:
1. зарегистрироваться в [VK-Cloud](https://cloud.vk.com/).
2. проверить привязку платежной карты к аккаунту.

Для возможности загрузки и дальнейшего развертывания выполняем следующее:
1. В каталоге сервисов [выбираем](https://cloud.vk.com/cloud-servers/) и создаем виртуальную машину (ВМ). При создании ВМ указываем в параметрах публичный SSH-ключ.
2. В "секреты" репозитория добавляем SSH_HOST, SSH_PORT (в нем указываем публичный IP-адрес ВМ и номер порта для подключения), SSH_USER, SSH_PASSWORD (указываем имя пользователя и пароль для доступа к учетной записи ВМ), SSH_PRIVATE_KEY (указываем приватный SSH-ключ). Данные "секреты" будут использоваться при деплое.
3. Далее запускаем pipeline на загрузку и развертывание в GitHub Actions, описанного в [./.github/workflows/classroom.yml](https://github.com/CALLlA-74/bauman-poker/blob/main/.github/workflows/classroom.yml).
